# 爬蟲實作說明與參考依據

## 📋 實作概述

本系統實作了實時爬蟲功能，從**蝦皮購物**和**露天拍賣**兩個平台獲取物品的最新價格資料，並在結果頁面顯示最新五筆參考資料。

---

## 🛒 蝦皮購物爬蟲

### 實作方式

1. **搜尋 URL 格式：**
   ```
   https://shopee.tw/search?keyword={物品名稱}
   ```

2. **技術挑戰：**
   - 蝦皮使用 JavaScript 動態載入商品資料
   - 需要處理 AJAX 請求或使用 Selenium
   - 商品資料可能以 JSON 格式嵌入在 HTML 中

3. **目前實作：**
   - 使用 `requests` + `BeautifulSoup` 進行基本爬取
   - 由於蝦皮的動態載入特性，目前提供框架結構
   - 實際部署時建議使用 Selenium 或解析 JSON 資料

4. **參考資料來源：**
   - 蝦皮官方搜尋頁面：`https://shopee.tw/search`
   - 蝦皮 API（如有公開）：可透過瀏覽器開發者工具查看 Network 請求

### 建議改進方向

1. **使用 Selenium：**
   ```python
   from selenium import webdriver
   from selenium.webdriver.common.by import By
   
   driver = webdriver.Chrome()
   driver.get(f"https://shopee.tw/search?keyword={item_name}")
   # 等待頁面載入
   items = driver.find_elements(By.CLASS_NAME, "shopee-search-item-result")
   ```

2. **解析 JSON 資料：**
   - 蝦皮的商品資料通常以 JSON 格式嵌入在 `<script>` 標籤中
   - 可以使用正則表達式提取 JSON 資料
   - 解析後取得商品名稱、價格、連結等資訊

3. **使用 API（如果可用）：**
   - 透過瀏覽器開發者工具（F12）查看 Network 標籤
   - 找到商品搜尋的 API 端點
   - 直接呼叫 API 獲取 JSON 資料

---

## 🏪 露天拍賣爬蟲

### 實作方式

1. **搜尋 URL 格式：**
   ```
   https://www.ruten.com.tw/find/?q={物品名稱}
   ```

2. **HTML 結構：**
   - 露天拍賣使用傳統的 HTML 結構
   - 商品資訊直接嵌入在 HTML 中
   - 相對容易使用 BeautifulSoup 解析

3. **目前實作：**
   - 使用 `requests` + `BeautifulSoup` 解析 HTML
   - 尋找商品列表容器（class 包含 'item'、'product'、'goods'）
   - 提取商品標題、價格、連結

4. **參考資料來源：**
   - 露天拍賣官方搜尋頁面：`https://www.ruten.com.tw/find/`
   - HTML 結構可透過瀏覽器開發者工具查看

### 實作細節

```python
# 露天拍賣爬蟲範例
url = f"https://www.ruten.com.tw/find/?q={search_query}"
response = requests.get(url, headers=headers)
soup = BeautifulSoup(response.text, 'html.parser')

# 尋找商品項目
items = soup.find_all('div', class_=re.compile('item|product|goods', re.I))

# 提取價格和標題
for item in items:
    price_elem = item.find(text=re.compile(r'[\d,]+'))
    title_elem = item.find('a')
    # ... 處理資料
```

---

## 🔧 技術實作細節

### 1. HTTP Headers 設定

為了模擬真實瀏覽器請求，設定了完整的 HTTP Headers：

```python
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'zh-TW,zh;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1'
}
```

### 2. 請求延遲

為避免被網站封鎖，在每次請求之間加入延遲：

```python
time.sleep(1)  # 延遲 1 秒
```

### 3. 錯誤處理

- 使用 `try-except` 處理網路錯誤
- 如果爬蟲失敗，自動回退到模擬資料
- 確保系統穩定運作

### 4. 資料格式

爬取的資料格式：

```python
{
    'item_name': '物品名稱',
    'price': 價格（整數）,
    'platform': '蝦皮' 或 '露天',
    'title': '商品標題',
    'url': '商品連結'
}
```

---

## 📊 資料顯示

### 結果頁面顯示

在結果頁面（`result.html`）中，會顯示：

1. **蝦皮購物區塊：**
   - 顯示最新 5 筆商品
   - 包含商品標題、價格、連結

2. **露天拍賣區塊：**
   - 顯示最新 5 筆商品
   - 包含商品標題、價格、連結

### 資料來源標示

每筆資料都會標示：
- 🛒 蝦皮購物
- 🏪 露天拍賣

---

## ⚠️ 注意事項

### 1. 法律與道德考量

- **遵守網站服務條款：** 使用爬蟲前請確認網站允許自動化存取
- **合理使用：** 不要過度頻繁請求，避免對伺服器造成負擔
- **尊重 robots.txt：** 檢查網站的 robots.txt 檔案

### 2. 技術限制

- **動態內容：** 蝦皮等網站使用 JavaScript 動態載入，可能需要 Selenium
- **反爬蟲機制：** 網站可能有驗證碼、IP 封鎖等機制
- **HTML 結構變動：** 網站改版可能導致爬蟲失效

### 3. 替代方案

如果爬蟲無法正常運作，系統會：
1. 自動回退到模擬資料
2. 顯示錯誤訊息
3. 確保系統仍可正常運作

---

## 🔄 未來改進方向

1. **使用 Selenium：** 處理 JavaScript 動態載入的網站
2. **API 整合：** 如果平台提供公開 API，優先使用
3. **快取機制：** 避免重複爬取相同物品
4. **並行處理：** 同時爬取多個平台，提升效率
5. **資料驗證：** 驗證爬取資料的完整性和正確性

---

## 📚 參考資源

### 技術文件

1. **BeautifulSoup 文件：**
   - https://www.crummy.com/software/BeautifulSoup/bs4/doc/

2. **Requests 文件：**
   - https://requests.readthedocs.io/

3. **Selenium 文件：**
   - https://www.selenium.dev/documentation/

### 網站結構分析工具

1. **瀏覽器開發者工具：** F12 開啟
2. **Postman：** 測試 API 請求
3. **curl：** 命令列測試 HTTP 請求

---

## 🎯 實作狀態

- [x] 基本爬蟲框架
- [x] 蝦皮搜尋 URL 設定
- [x] 露天搜尋 URL 設定
- [x] HTTP Headers 設定
- [x] 錯誤處理機制
- [x] 資料格式定義
- [x] 結果頁面顯示
- [ ] Selenium 整合（待實作）
- [ ] API 整合（待實作）
- [ ] 快取機制（待實作）

---

**最後更新：** 2024年

